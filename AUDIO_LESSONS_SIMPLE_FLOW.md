# ๐ต Audio Lessons: Simple Flow

## The Complete System (Super Simple Explanation)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     USER UPLOADS PDF                         โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              TEXT EXTRACTION (Already Works!)                โ
โ  โข Zapier webhook extracts text from PDF                     โ
โ  โข Returns plain text content                                โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            KEYWORD EXTRACTION (Already Works!)               โ
โ  โข OpenAI analyzes text                                      โ
โ  โข Extracts vocabulary terms                                 โ
โ  โข Creates definitions & translations                        โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         SCRIPT GENERATION & SAVING (Already Works!)          โ
โ  โข Organizes vocabulary into lesson                          โ
โ  โข Saves to esp_lessons table                                โ
โ  โข Saves vocabulary to lesson_vocabulary table               โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ    ๐ AWS POLLY TEXT-TO-SPEECH          โ
        โ    (This is what we're adding!)         โ
        โโโโโโโโโโโโโโโคโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   FORMAT AUDIO SCRIPT                        โ
โ  โข Take lesson vocabulary                                    โ
โ  โข Create natural-sounding script:                           โ
โ    "Term 1: Apple. Definition: A red fruit..."               โ
โ  โข Add pauses and formatting                                 โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ               GENERATE AUDIO WITH AWS POLLY                  โ
โ  โข Send script to AWS Polly                                  โ
โ  โข Polly converts text โ speech                              โ
โ  โข Returns MP3 audio file                                    โ
โ  โข Uses "Joanna" voice (neural engine)                       โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                 UPLOAD AUDIO TO S3                           โ
โ  โข Upload MP3 to S3 bucket                                   โ
โ  โข Make it publicly accessible                               โ
โ  โข Get permanent URL                                         โ
โ  โข Example: https://bucket.s3.aws.com/audio.mp3             โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              SAVE AUDIO INFO TO DATABASE                     โ
โ  โข Save to audio_lessons table                               โ
โ  โข Store: audio_url, duration, title, etc.                   โ
โ  โข Link to original lesson                                   โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  DISPLAY IN APP                              โ
โ  โข User sees audio lesson in list                            โ
โ  โข Tap to play                                               โ
โ  โข Audio streams from S3                                     โ
โ  โข Can pause, replay, delete                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## What You Need to Do (Step by Step)

### โ Step 1: Database (5 minutes)
```bash
# Run this SQL file in Supabase:
create_audio_lessons_table.sql
```

**Creates:** `audio_lessons` table to store audio info

---

### โ Step 2: AWS Setup (15 minutes)

**A. Create AWS Account** (if you don't have one)
- Go to aws.amazon.com
- Sign up for free tier

**B. Create IAM User**
- AWS Console โ IAM โ Users โ Create User
- Name: `unilingo-polly-user`
- Attach policies: `AmazonPollyFullAccess` + `AmazonS3FullAccess`
- **Save credentials:**
  - Access Key ID: `AKIA...`
  - Secret Access Key: `wJalr...`

**C. Create S3 Bucket**
- AWS Console โ S3 โ Create Bucket
- Name: `unilingo-audio-lessons` (must be unique)
- Region: `us-east-1` (or closest to you)
- Uncheck "Block all public access"
- Add bucket policy (from setup guide)

---

### โ Step 3: Backend Setup (5 minutes)

**A. Install AWS SDK**
```bash
cd backend
npm install @aws-sdk/client-polly @aws-sdk/client-s3
```

**B. Add to `.env`**
```env
AWS_ACCESS_KEY_ID=your_key_here
AWS_SECRET_ACCESS_KEY=your_secret_here
AWS_REGION=us-east-1
AWS_S3_BUCKET=unilingo-audio-lessons
```

**C. Files Already Created:**
- โ `backend/pollyService.js` - Core audio generation
- โ `backend/audioEndpoints.js` - API routes
- โ `backend/server.js` - Routes registered

**D. Restart Server**
```bash
npm start
```

Look for:
```
๐๏ธ PollyService initialized
โ Audio endpoints registered
```

---

### โ Step 4: Frontend Setup (10 minutes)

**A. File Already Created:**
- โ `src/lib/audioLessonService.ts`

**B. Update AudioRecapScreen.tsx**
- Follow instructions in `AUDIO_LESSONS_SETUP_GUIDE.md`
- Or I can make these changes for you!

---

### โ Step 5: Test (5 minutes)

1. **Create a regular lesson** (upload PDF as usual)
2. **Generate audio:**
   - Go to Lessons โ Audio Recap
   - Tap "Upload PDF" โ Select your lesson
   - Wait ~30 seconds
3. **Play audio:**
   - Tap on the audio lesson
   - Should play automatically!

---

## Cost Estimate

Very affordable! ๐ฐ

- **100 audio lessons/month**
- **Average 5,000 characters per lesson**
- **Total: 500,000 characters/month**

**Monthly Cost:**
- AWS Polly: ~$2.00
- AWS S3: ~$0.10
- **Total: ~$2.10/month** ๐

---

## Files You Have

โ Already created for you:
```
create_audio_lessons_table.sql      โ Database schema
backend/pollyService.js              โ AWS Polly integration
backend/audioEndpoints.js            โ API endpoints
backend/server.js                    โ Routes registered
src/lib/audioLessonService.ts        โ Frontend service
AUDIO_LESSONS_SETUP_GUIDE.md        โ Detailed instructions
AUDIO_LESSONS_SIMPLE_FLOW.md         โ This file
```

๐ Need to update:
```
backend/.env                         โ Add AWS credentials
src/screens/AudioRecapScreen.tsx     โ Update UI logic
```

---

## Quick Start Commands

```bash
# 1. Install AWS SDK
cd backend
npm install @aws-sdk/client-polly @aws-sdk/client-s3

# 2. Add AWS credentials to backend/.env
# (Open file and paste your keys)

# 3. Restart backend
npm start

# 4. Run SQL in Supabase
# (Copy/paste create_audio_lessons_table.sql)

# 5. Update AudioRecapScreen.tsx
# (Follow setup guide or ask me to do it!)

# 6. Test in app!
```

---

## That's It!

The system is **90% done**. You just need to:
1. โฐ Add AWS credentials (2 min)
2. โฐ Run SQL file (1 min)
3. โฐ Update AudioRecapScreen (10 min)

**Total time: ~15 minutes** (plus AWS account setup if needed)

---

## Need Help?

**Option 1:** Follow the detailed guide in `AUDIO_LESSONS_SETUP_GUIDE.md`

**Option 2:** Ask me to:
- Create AWS account with you
- Update AudioRecapScreen for you
- Test the entire flow with you
- Troubleshoot any issues

**Option 3:** Test what we have so far:
```bash
# Test if backend is ready
curl -X POST http://localhost:3001/api/audio/generate-lesson \
  -H "Content-Type: application/json" \
  -d '{"lessonId":"test","userId":"test"}'
```

---

## What Makes This Simple?

1. **Database already has lessons** โ
2. **PDF processing already works** โ
3. **OpenAI keyword extraction already works** โ
4. **Just adding audio generation** ๐
5. **Most code already written** โ

You're literally just:
- Plugging in AWS credentials
- Running one SQL file
- Updating one React component

That's it! ๐

